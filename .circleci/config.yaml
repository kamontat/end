version: 2.1

commands:
  info:
    description: Start workflow
    steps:
      - hello/circleci-env-highlights
      - hello/system-info

orbs:
  hello: circleci/hello-build@0.0.14
  node: circleci/node@2.1.0
  codecov: codecov/codecov@1.0.5
  sonarcloud: sonarsource/sonarcloud@1.0.1

jobs:
  main:
    executor:
      name: node/default
      tag: "12.16"
    environment:
      ENV: "ci"
    steps:
      - checkout
      - info
      - node/install-packages:
          cache-version: "v1-lerna"
          cache-key: "yarn.lock"
          pkg-manager: yarn
          include-branch-in-cache-key: false
      - run:
          name: Bootstraping...
          command: yarn bootstrap
      - run:
          name: Building...
          command: yarn build:ci
      - run:
          name: Testing...
          command: yarn test:ci

workflows:
  version: 2
  default:
    jobs:
      - main
